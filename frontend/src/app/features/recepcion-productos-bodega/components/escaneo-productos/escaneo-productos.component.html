<div class="scan-container">

  <!-- PANEL IZQUIERDO -->
  <div class="left-panel">

    <form [formGroup]="loteForm">

      <label class="header-text">Datos del lote</label>

      <div class="form-group">
        <label>N煤mero de lote</label>
        <input type="text" class="input-box" formControlName="numeroLote">
      </div>

      <div class="form-group">
        <label>Fecha de elaboraci贸n</label>
        <input type="date" class="input-box" formControlName="fechaElaboracion">
      </div>

      <div class="form-group">
        <label>Fecha de vencimiento</label>
        <input type="date" class="input-box" formControlName="fechaVencimiento">
      </div>

      <div class="form-group">
        <label>Cantidad</label>
        <input type="number" class="input-box" formControlName="cantidad">
      </div>

      <div class="form-group">
        <label>L铆mite merma</label>
        <input type="number" class="input-box" formControlName="limiteMerma">
      </div>

      <label class="header-text">Producto</label>

      <!-- BUSCAR PRODUCTO -->
      <div class="form-group">
        <input
          type="text"
          placeholder="Buscar producto..."
          class="input-box"
          [(ngModel)]="productoSearch"
          [ngModelOptions]="{standalone: true}"
        >
      </div>

      <button type="button" class="btn-search" (click)="buscarProductosBackend()">
        Buscar
      </button>

      <!-- RESULTADOS -->
      <div class="dropdown-list" *ngIf="productosFiltrados.length > 0">
        @for (p of productosFiltrados; track p.idProducto) {
          <div class="dropdown-item" (click)="seleccionarProducto(p)">
            <strong>{{ p.nombreComercial }}</strong><br>
            <span>{{ p.nombreGenerico }}</span> 路 <span>{{ p.categoria }}</span>
          </div>
        }
      </div>

      <!-- CDIGO DE BARRA -->
      <div class="form-group">
        <label>C贸digo de barra</label>
        <input type="text" class="input-box" formControlName="codigoBarra">
      </div>

      <!-- PRECIO UNITARIO -->
      <div class="form-group">
        <label>Precio unitario</label>
        <input type="number" class="input-box" formControlName="precioUnitario">
      </div>

      <!-- AADIR LOTE -->
      <button type="button" class="btn-add-batch" (click)="addBatch()">
        A帽adir lote <span class="plus-icon">+</span>
      </button>

    </form>

  </div>

  <!-- PANEL DERECHO LOTES + FINALIZAR -->
  <div class="right-panel">

    <!-- LISTA DE LOTES -->
    <div class="batch-list" *ngIf="batches.length > 0">
      <h3 class="header-text">Lotes a帽adidos</h3>

      @for (b of batches; let i = $index; track i) {
        <div class="batch-card">

          <div class="left-info">
            <p><strong>Lote:</strong> {{ b.numeroLote }}</p>
            <p><strong>Elaboraci贸n:</strong> {{ b.fechaElaboracion }}</p>
            <p><strong>Vencimiento:</strong> {{ b.fechaVencimiento }}</p>
            <p><strong>Cantidad:</strong> {{ b.cantidad }}</p>
            <p><strong>Merma:</strong> {{ b.limiteMerma }}</p>
            <p><strong>Precio unitario:</strong> {{ b.precioUnitario }}</p>
            <p><strong>C贸digo Barra:</strong> {{ b.codigoBarra }}</p>
          </div>

          <div class="right-info">
            <p><strong>Producto:</strong> {{ b.product.nombreComercial }}</p>
            <p>{{ b.product.nombreGenerico }}</p>
            <p>{{ b.product.categoria }}</p>
          </div>

          <button class="delete-batch-btn" (click)="eliminarLote(i)"></button>

        </div>
      }
    </div>

    <!-- FINALIZAR -->
    <button class="btn-finalize" (click)="finalize()">Finalizar</button>

  </div>

</div>
