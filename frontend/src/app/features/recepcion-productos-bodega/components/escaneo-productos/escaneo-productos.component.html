<div class="scan-container">

  <!-- PANEL IZQUIERDO -->
  <div class="left-panel">

    <form [formGroup]="loteForm">

      <label class="header-text">Datos del lote</label>

      <div class="form-group">
        <label>Número de lote</label>
        <input type="text" class="input-box" formControlName="numeroLote">
      </div>

      <div class="form-group">
        <label>Fecha de elaboración</label>
        <input type="date" class="input-box" formControlName="fechaElaboracion">
      </div>

      <div class="form-group">
        <label>Fecha de vencimiento</label>
        <input type="date" class="input-box" formControlName="fechaVencimiento">
      </div>

      <div class="form-group">
        <label>Cantidad</label>
        <input type="number" class="input-box" formControlName="cantidad">
      </div>

      <div class="form-group">
        <label>Límite merma</label>
        <input type="number" class="input-box" formControlName="limiteMerma">
      </div>

      <label class="header-text">Código del producto</label>

      <div class="form-group">
        <input type="text" class="input-box" placeholder="Código de barra" formControlName="codigoBarra">
      </div>

      <!-- BOTÓN BUSCAR PRODUCTO -->
      <button type="button" class="btn-search" (click)="buscarProducto()">Buscar Producto</button>

      <!-- BOTÓN AÑADIR LOTE -->
      <button type="button" class="btn-add-batch" (click)="addBatch()">
        Añadir otro lote <span class="plus-icon">+</span>
      </button>

    </form>

    <!-- LISTA DE LOTES AÑADIDOS (TARJETAS) -->
    <div class="batch-list" *ngIf="batches.length > 0">

      <h3 class="header-text">Lotes añadidos</h3>

      @for (b of batches; track b.numeroLote) {
        <div class="batch-card">

          <div class="left-info">
            <p><strong>Lote:</strong> {{ b.numeroLote }}</p>
            <p><strong>Elaboración:</strong> {{ b.fechaElaboracion }}</p>
            <p><strong>Vencimiento:</strong> {{ b.fechaVencimiento }}</p>
            <p><strong>Cantidad:</strong> {{ b.cantidad }}</p>
            <p><strong>Límite Merma:</strong> {{ b.limiteMerma }}</p>
            <p><strong>Código Barra:</strong> {{ b.codigoBarra }}</p>
          </div>

          <div class="right-info" *ngIf="b.product">
            <div class="product-mini-card">
              <img [src]="b.product.imageUrl" alt="Producto">

              <div>
                <h4>{{ b.product.name }}</h4>
                <p class="subtitle">{{ b.product.genericName }}</p>
                <p class="meta">{{ b.product.details }}</p>
              </div>
            </div>
          </div>

        </div>
      }

    </div>

  </div>

  <!-- PANEL DERECHO – PRODUCTO SCANEADO -->
  <div class="right-panel">

    <h2 class="header-text">Producto</h2>

    @if (scannedProduct) {
      <div class="product-card">
        <div class="card-image">
          <img [src]="scannedProduct.imageUrl" alt="Producto">
        </div>
        <div class="card-details">
          <h3>{{ scannedProduct.name }}</h3>
          <p class="subtitle">{{ scannedProduct.genericName }}</p>
          <p class="meta">{{ scannedProduct.details }}</p>
        </div>
      </div>
    }

  </div>

  <!-- BOTÓN FINALIZAR -->
  <div class="footer-action">
    <button class="btn-finalize" (click)="finalize()">Finalizar</button>
  </div>

</div>
