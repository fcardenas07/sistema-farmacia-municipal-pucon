<div class="scan-container">

  <!-- PANEL IZQUIERDO -->
  <div class="left-panel">

    <form [formGroup]="loteForm">

      <label class="header-text">Datos del lote</label>

      <!-- Número de lote -->
      <div class="form-group">
        <label>Número de lote</label>
        <input type="text" class="input-box" formControlName="numeroLote">
      </div>

      <!-- Fecha elaboración -->
      <div class="form-group">
        <label>Fecha de elaboración</label>
        <input type="date" class="input-box" formControlName="fechaElaboracion">
      </div>

      <!-- Fecha vencimiento -->
      <div class="form-group">
        <label>Fecha de vencimiento</label>
        <input type="date" class="input-box" formControlName="fechaVencimiento">
      </div>

      <!-- Cantidad -->
      <div class="form-group">
        <label>Cantidad</label>
        <input type="number" class="input-box" formControlName="cantidad">
      </div>

      <!-- Límite merma -->
      <div class="form-group">
        <label>Límite merma</label>
        <input type="number" class="input-box" formControlName="limiteMerma">
      </div>

      <!-- DROPDOWN DE PRODUCTOS -->
      <label class="header-text">Producto</label>

      <div class="form-group">
        <input
          type="text"
          placeholder="Buscar producto..."
          class="input-box"
          [(ngModel)]="productoSearch"
          (input)="buscarProductoPorNombre()"
          [ngModelOptions]="{standalone: true}"
        >
      </div>

      <div class="dropdown-list" *ngIf="productosFiltrados.length > 0">
        @for (p of productosFiltrados; track p.idProducto) {
          <div class="dropdown-item" (click)="seleccionarProducto(p)">
            <strong>{{ p.nombreComercial }}</strong>
            <br>
            <span>{{ p.nombreGenerico }}</span> · 
            <span>{{ p.categoria }}</span>
          </div>
        }
      </div>

      <!-- Código de barra -->
      <div class="form-group">
        <label>Código de barra (opcional)</label>
        <input type="text" class="input-box" placeholder="Código de barra" formControlName="codigoBarra">
      </div>

      <!-- AÑADIR LOTE -->
      <button type="button" class="btn-add-batch" (click)="addBatch()">
        Añadir lote <span class="plus-icon">+</span>
      </button>

    </form>

    <!-- LISTA DE LOTES EN TARJETAS -->
    <div class="batch-list" *ngIf="batches.length > 0">
      <h3 class="header-text">Lotes añadidos</h3>

      @for (b of batches; track b.numeroLote) {
        <div class="batch-card">

          <div class="left-info">
            <p><strong>Lote:</strong> {{ b.numeroLote }}</p>
            <p><strong>Elaboración:</strong> {{ b.fechaElaboracion }}</p>
            <p><strong>Vencimiento:</strong> {{ b.fechaVencimiento }}</p>
            <p><strong>Cantidad:</strong> {{ b.cantidad }}</p>
            <p><strong>Merma:</strong> {{ b.limiteMerma }}</p>
            <p><strong>Código Barra:</strong> {{ b.codigoBarra || 'Sin código' }}</p>
          </div>

          <div class="right-info">
            <p><strong>Producto:</strong> {{ b.product.nombreComercial }}</p>
            <p>{{ b.product.nombreGenerico }}</p>
            <p>{{ b.product.categoria }}</p>
          </div>

        </div>
      }
    </div>

  </div>


  <!-- BOTÓN FINALIZAR -->
  <div class="footer-action">
    <button class="btn-finalize" (click)="finalize()">Finalizar</button>
  </div>

</div>
